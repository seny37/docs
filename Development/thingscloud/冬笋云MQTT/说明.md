# 冬笋云 MQTT协议接入说明书

## 什么是冬笋云

冬笋云是提供物联网网关管理维护的开放平台，提供网关在线管理、网关应用开发与发布、设备数据存储和分析、终端设备的管理和维护等物联网基础功能

## 什么是MQTT

MQTT是基于TCP/IP协议栈构建的异步通信消息协议，是一种轻量级的发布/订阅信息传输协议。MQTT在时间和空间上，将消息发送者与接受者分离，可以在不可靠的网络环境中进行扩展。适用于设备硬件存储空间有限或网络带宽有限的场景。物联网平台支持设备使用MQTT协议接入。[更多信息](https://mqtt.org)

### 支持的版本

兼容3.1和3.1.1版本协议

## 谁在使用此协议

* [FreeIOE](https://freeioe.org)\
    是一款开源、开放的物联网网关框架。提供丰富的设备接入、边缘计算、设备远程维护的编程框架，方便用户快速定制开发符合自己业务需求的网关产品。
  
## MQTT连接方式

冬笋云支持以下接入方式：

* TCP通道基础 + TLS协议（TLSV1、 TLSV1.1和TLSV1.2 版本）：安全级别高。
* TCP方式（数据不加密） + HTTPS服务器认证：安全级别中。 ***开发中***
* TCP方式（数据不加密）：安全级别低。
  
网关接入认证的[详细信息](连接.md)

* [什么是TLS](https://baike.baidu.com/item/TLS)
* [TLS如何保证安全](https://segmentfault.com/a/1190000007075961)

## 上下线通知

使用主题: /<网关产品序列号>/status 来发送网关上下线消息。

### 数据(Playload)

* ONLINE
* OFFLINE

### 建议实现方式

1. 当网关连接成功时，发送一条网关上线信息(ONLINE)
2. 使用MQTT Will信息，发送OFFLINE信息 (OFFLINE)

## 功能主题分类

| 分类 | 说明 |
| :--- | :--- |
| 设备（上送、下置、指令) | [详细说明](设备.md) |
| 应用（安装、升级、卸载、配置） | [详细说明](应用.md) |
| 网关配置  | [详细说明](网关配置.md) |
| 网关诊断（报文、日志上送） | [详细说明](网关诊断.md)|

## 协议数据(Payload)格式以及压缩

### 数据格式

Payload数据为JSON格式（上下线通知除外)，各主题JSON数据规定详见功能主题说明

### 数据压缩

数据压缩是指使用ZIP对Payload中的JSON文本压缩。因此压缩后的数据为二进制数据，而不再是JSON文本。 建议使用最新的zlib库进行数据压缩，保证兼容性。
